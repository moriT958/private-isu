---
- hosts: bench
  become: yes
  gather_facts: no
  vars:
    bench_dir: "/home/isucon/private_isu/benchmarker"
    repo_root: "{{ playbook_dir }}/../../../"
  tasks:
    - name: Ensure benchmarker directory exists
      file:
        path: "{{ bench_dir }}"
        state: directory
        owner: isucon
        group: isucon
        mode: "0755"
    - name: Sync benchmarker to server
      ansible.builtin.synchronize:
        src: "{{ repo_root }}/benchmarker/"
        dest: "{{ bench_dir }}/"
        delete: yes
    - name: Fix ownership
      file:
        path: "{{ bench_dir }}"
        owner: isucon
        group: isucon
        recurse: yes
